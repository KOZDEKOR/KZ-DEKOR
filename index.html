<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Stok Takip - Basit (PWA)</title>
<meta name="theme-color" content="#2d6a4f">
<link rel="manifest" href="manifest.json">
<link rel="icon" href="icon-192.svg" sizes="192x192" type="image/svg+xml">
<style>
  body{font-family:Arial,Helvetica,sans-serif;max-width:640px;margin:auto;padding:18px;background:#f4f4f4}
  h1{text-align:center;margin-bottom:8px}
  .card{background:#fff;padding:12px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.06)}
  input, select, button{padding:12px;margin:6px 0;width:100%;box-sizing:border-box;border:1px solid #ddd;border-radius:6px}
  table{width:100%;border-collapse:collapse;margin-top:12px}
  th,td{border:1px solid #eee;padding:8px;text-align:center}
  th{background:#fafafa}
  .row{display:flex;gap:8px}
  .col{flex:1}
  .btn{font-weight:600;cursor:pointer;border:0;padding:10px;border-radius:6px}
  .btn-plus{background:#2d6a4f;color:#fff}
  .btn-minus{background:#e63946;color:#fff}
  .small{font-size:13px;color:#666;margin-top:8px;text-align:center}
</style>
</head>
<body class="card">

<h1>ðŸ“¦ Stok Takip</h1>

<input id="urunAdi" placeholder="ÃœrÃ¼n adÄ± (Ã¶r: 80 mm sÃ¼pÃ¼rgelik)">
<select id="kategori">
  <option value="SÃ¼pÃ¼rgelik">SÃ¼pÃ¼rgelik</option>
  <option value="Duvar Paneli">Duvar Paneli</option>
</select>
<input id="stokMiktar" type="number" placeholder="BaÅŸlangÄ±Ã§ stok (0)">
<input id="not" placeholder="Not (isteÄŸe baÄŸlÄ±)">
<button class="btn" id="btnEkle">ÃœrÃ¼n Ekle</button>

<input id="arama" placeholder="ÃœrÃ¼n ara..." oninput="listele()">

<table id="stokTablosu" class="card" aria-live="polite">
  <thead>
    <tr><th>ÃœrÃ¼n</th><th>Kategori</th><th>Stok</th><th>Not</th><th>Ä°ÅŸlem</th></tr>
  </thead>
  <tbody></tbody>
</table>

<div class="row" style="margin-top:12px">
  <button class="btn" id="btnCsv" style="flex:1">ðŸ“¥ CSV Ä°ndir</button>
  <input id="csvYukle" type="file" accept=".csv" style="flex:1">
</div>

<div class="small">Uygulama Ã§evrimdÄ±ÅŸÄ± Ã§alÄ±ÅŸÄ±r ve ana ekrana eklenebilir.</div>

<script>
const STORAGE_KEY = 'stok_basit_v2';
let stoklar = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(stoklar)); }
function temizleForm(){ document.getElementById('urunAdi').value=''; document.getElementById('stokMiktar').value=''; document.getElementById('not').value=''; }
function listele(){
  const q = document.getElementById('arama').value.toLowerCase();
  const tbody = document.querySelector('#stokTablosu tbody');
  tbody.innerHTML = '';
  stoklar.filter(s=>s.ad.toLowerCase().includes(q)).forEach((s,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${escapeHtml(s.ad)}</td>
                    <td>${escapeHtml(s.kategori)}</td>
                    <td>${s.miktar}</td>
                    <td>${escapeHtml(s.not||'')}</td>
                    <td>
                      <button class="btn btn-plus" onclick="stokArtir(${i})">+</button>
                      <button class="btn btn-minus" onclick="stokAzalt(${i})">-</button>
                    </td>`;
    tbody.appendChild(tr);
  });
}

function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m])); }

function urunEkle(){
  const ad = document.getElementById('urunAdi').value.trim();
  if(!ad) return alert('ÃœrÃ¼n adÄ± girin');
  const kategori = document.getElementById('kategori').value;
  const miktar = parseInt(document.getElementById('stokMiktar').value) || 0;
  const not = document.getElementById('not').value.trim();
  stoklar.push({ad, kategori, miktar, not});
  save(); temizleForm(); listele();
}
function stokArtir(i){ stoklar[i].miktar++; save(); listele(); }
function stokAzalt(i){ if(stoklar[i].miktar>0) stoklar[i].miktar--; save(); listele(); }

document.getElementById('btnEkle').addEventListener('click', urunEkle);
document.getElementById('btnCsv').addEventListener('click', ()=>{
  const csv = 'ÃœrÃ¼n,Kategori,Stok,Not\n' + stoklar.map(s=>`"${s.ad.replace(/"/g,'""')}","${s.kategori}","${s.miktar}","${(s.not||'').replace(/"/g,'""')}"`).join('\n');
  const blob = new Blob([csv], {type:'text/csv'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'stoklar.csv'; a.click();
});

document.getElementById('csvYukle').addEventListener('change', (e)=>{
  const file = e.target.files[0]; if(!file) return;
  const reader = new FileReader();
  reader.onload = ()=>{
    const lines = reader.result.split('\n').slice(1);
    lines.forEach(line=>{
      if(!line.trim()) return;
      // Quick CSV parse for quoted fields
      const parts = line.match(/(".*?"|[^",\s]+)(?=,|$)/g) || [];
      const ad = (parts[0]||'').replace(/^"|"$/g,'');
      const kategori = (parts[1]||'').replace(/^"|"$/g,'');
      const miktar = parseInt((parts[2]||'').replace(/^"|"$/g,'')) || 0;
      const not = (parts[3]||'').replace(/^"|"$/g,'');
      stoklar.push({ad,kategori,miktar,not});
    });
    save(); listele();
  };
  reader.readAsText(file);
});

listele();

// register service worker for PWA
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js').then(()=>{
    console.log('Service worker kaydedildi');
  }).catch(e=> console.warn('SW kaydetme hatasÄ±', e));
}
</script>

</body>
</html>